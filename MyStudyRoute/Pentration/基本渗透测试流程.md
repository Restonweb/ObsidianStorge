# 枚举
## 从外部枚举主机
这将是一个简短的部分，介绍如何查找从 Internet 响应的 IP。 在这种情况下，有一些 IP 范围（甚至可能是几个范围），只是为了找到哪些 IP 正在响应。
### ICMP
```sh
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### 枚举TCP端口
发现所有类型的ICMP数据包都被过滤是很常见的。然后，要检查主机是否已启动，所能做的就是尝试查找打开的端口。每个主机有 65535 个端口，因此，如果有一个“大”范围，则无法测试每个主机的每个端口是否打开，这将花费太多时间。需要使用快速端口扫描仪（ masscan ）和更多使用的端口列表：
```sh
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
也可以使用 `nmap` 执行此步骤，但它速度较慢，并且 `nmap` 无法识别有些主机。
### 枚举HTTP端口
专门扫HTTP服务时：
```sh
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### 枚举UDP端口
还可以尝试检查某些 UDP 端口是否打开，以决定是否应该更加关注某个主机。 由于 UDP 服务通常不会对常规空 UDP 探测数据包做出任何数据响应，因此很难判断端口是否被过滤或打开。决定这一点的最简单方法是发送与正在运行的服务相关的数据包，由于不知道哪个服务正在运行，因此根据端口号尝试最有可能的：
```sh
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
nmap 将测试 /24 范围内每个主机中的前 1000 个 UDP 端口，但即使仅此也需要 >20 分钟。如果需要最快的结果，可以使用 udp-proto-scanner ： `./udp-proto-scanner.pl 199.66.11.53/24` 这会将这些 UDP 探测器发送到其预期端口（对于 /24 范围，这只需要 1 分钟）：
```UDP服务探针
DNSStatusRequest、DNSVersionBindReq、NBTStat、NTPRequest、RPCCheck、SNMPv3GetRequest、chargen、citrix、daytime、db2、echo、gtpv1、ike、ms-sql、ms-sql-slam、netop、ntp、rpc、snmp-public、systat、tftp、time、xdmcp。
```
### 用SCTP发现端口
```sh
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## 从内部枚举主机
### 被动枚举
可以使用以下工具被动地发现已连接网络中的主机：
```sh
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### 主动枚举
注意，[[#从外部枚举主机]]中的任何手段也可以在此应用