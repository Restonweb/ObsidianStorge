# 常用事件研判方法
## 详细研判
点击事件名称，进入详情页面，查看信息进行分析。
适用于现有信息不够进行研判时使用。
## 批量研判
在事件列表页面直接调取出请求体，响应体等信息，直接进行分析。
效率最高。
## 快捷研判
直接在事件后点击快捷研判，会调出这个事件的请求体、响应体等信息，可以快速进行研判切换下一个事件。
适用于攻防演练期间需要实时处理新的安全事件。
# 分析思路
- 告警事件是否为误报？
- 攻击是否成功？
## 误报判断
1. 一些攻击采用了宽泛的规则匹配
2. 识别算法的缺陷
3. 业务的正常相应内容与现有的规则相似，被规则比对成功。(如老旧系统直接使用sql语句进行查询，以及十六进制字符串被识别为冰蝎webshell)
对其流量进行分析，看其是否包含攻击载荷，并分析是那些特征触发了告警。
对于一些告警，可以判断历史告警事件，若长期存在此告警且无危害，则有可能是误报或无关事件。

### 特征判断
攻击流量一般有明显的特征，如下：
#### URL恶意拼接
包中含有外部的URL。
这类特征一般被用来下载获取挂载在服务器上的恶意脚本来执行，判断这个服务器的URL信息是否被访问来判断资产是否受到影响。
#### 包含系统命令
包中含有可疑的系统命令。
常见的RCE会使用whoami/id来判断是否攻击成功，构造ReverseShell或连接三方站点判断是否可以出网。
#### 攻击工具的指纹特征
攻击工具会存在一些特定的特征，可以被平台识别，可以根据这些信息判断攻击者的攻击意图。
#### 外联IP
包中含有外联IP。
Payload中含有外联IP端口，或者外部域名，DNSlog的访问。
#### 服务与攻击类型对应
常见的web服务都有其特定对应的攻击方式，常见于各种组件、中间件。可以结合服务类型判断是否为攻击。
如特定组件的SSRF,OA系统的漏洞利用，数据库的未授权、中间件的漏洞。
非http服务类主要包含应用层的协议如FTP/SMTP等的未授权，WEBlogicT3

### 是否业务触发
例
#### 业务触发sql注入告警
正常的业务可能会拼接使用sql服务进行查询信息，要判断查询的信息是否为正常业务，有无恶意性。误报可以加白。
#### 业务payload反序列化
Java会经常使用到序列化流量，需要判断目标IP是否包含其他的敏感告警（真实攻击意图）来排查。
#### 业务Webshell文件误报
一些业务系统会记录漏洞特征，可能就会包含利用这些漏洞的webshell等，可能会被规则直接匹配中，根据URL或IP对应规则进行加白。
#### 业务URL命中规则
一些特征规则匹配特定的关键字，一些正常业务可能会包含这些关键字，此类的告警的攻击结果一般为未知，根据情况分析，相关告警量过大可以进行加白处理。
#### 集权认证被识别为爆破
常见堡垒机，集权认证设备会有大量用户同时使用认证，导致触发ssh，rdp的爆破攻击告警。此类判断完成可以加白。

#### EXP版本不适用服务版本
根据上下文观察URI以及组件相应内容判断组件版本，而攻击者使用了不受影响范围的EXP，此类攻击可以根据现有的漏洞浮现信息，或模拟攻击测试来判断是否成功。对于无法直接判断组件版本的，可以上机查看相关服务版本，不在影响范围内可以加白。
#### 日常的渗透测试
日常会经常存在针对客户资产渗透测试的情况，为了与真实攻击区分。测试过程中会包含特殊字符信息的自动化脚本或工具。如外链不存在特殊URL。
#### 编程语言不匹配
组件使用的编程语言与告警的上下文使用的编程语言不匹配，大概率为误报。
如php站的java告警。
## 判断攻击是否成功
整体研判成功维度主要有以下几点：

1. 响应体是否存在命令执行的回显，如远程命令执行、文件上传、创建、echo/print输出打印内容；
2. 是否真正执行请求体中的远程命令，即主动外联发起请求，如请求体中远程下载文件、请求dnslog、反弹shell等
3. dip被攻击后终端本地是否有变动，例如落地了新文件、配置文件被修改、新增了用户、计划任务、恶意进程等
4. dip是否又主动作为sip发起攻击，如横向移动、扫描探测、内网爆破等
5. 会话日志中通信特征可以辅助判断，如TTL（连接时长较大、心跳周期性连接等）、上下行字节过大等
6. 未授权接口直接请求返回对应的接口数据
7. 攻击上传的文件是否可以直接访问
8. 状态码辅助判断，如大多数情况是200，但302、500、400都有可能成功
9. 数据库爆破或cmd执行有对应数据库访问日志则基本攻击成功
10. Web爆破登录类：1）登录url重定向：Location头部；2）未授权 Basic Unauthorized
11. 关键字辅助特征：响应中有接口关键返回信息，如success、accept、成功、logded in/on、失败、failed、not accept等
### 请求与响应
大部分web攻击事件可以查看payload中是否有执行的命令，攻击者一般会查看系统敏感文件或配置文件来验证是否攻击成功。
关键要素在于**流量上下文**，即分析**请求**，判断其**攻击意图**，分析**响应**，判断攻击请求是否被**一致响应**，一致则攻击成功。
对于WEB攻击，将结果分为是否有回显两种情况。有回显则判断攻击成功，但无回显也不一定是攻击失败，需要进一步结合信息进行分析。
请求&回显：
491084,491062,490207,490205,490183
#### 有回显
分析攻击请求中是否有让目标回显结果(RCE结果、文件上传路径、登陆尝试结果等)的代码，看回显是否可以和攻击请求对应。
#### 无回显
无回显将会比较复杂，要结合漏洞与攻击行为与实际情况讨论。
例1：tomcat上传webshell，使用put协议，返回状态码201 Created无回显信息，但根据状态码和对webshell的直接访问或查看访问日志可知webshell上传成功。此次攻击成功。
例2：sql注入的布尔盲注和时间盲注是没有对应具体的响应信息的，页面会正常显示查询到的信息，需要对请求进行解码分析查看，确定其是否为布尔盲注或时间盲注（IF ORD SLEEP ASCII码的比对）
对于这种攻击可以使用数据包重放，查看是否有时间延迟。判断是否有sql注入漏洞。
***==特别需要注意的是，进行攻击流量重放需要征求客户方的同意，切勿私自重放流量以被误当作为攻击方的攻击流量。另外，在进行流量重放前，需要修改原攻击性质的载荷为对系统不产生实质危害的验证性载荷。==***
### 关联流量日志进行研判
某些攻击是没有回显的，从payload无法判断攻击是否成功，如反弹shell,下载远程文件，dnslog探测，这些主要查看被攻击的DstIP是否主动去连接了Payload中的ip（**会话连接**）或域名。
